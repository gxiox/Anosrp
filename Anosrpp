------------------------------------------------
-- ðŸ”§ SERVICES
------------------------------------------------
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Vim = game:GetService("VirtualInputManager")

------------------------------------------------
-- ðŸ‘¤ PLAYER
------------------------------------------------
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local backpack = player:WaitForChild("Backpack")
local pityBoss = player:WaitForChild("Pity"):WaitForChild("Boss")

------------------------------------------------
-- ðŸ” CHARACTER
------------------------------------------------
local character, hrp
local function onChar(char)
	character = char
	hrp = char:WaitForChild("HumanoidRootPart")
end
onChar(player.Character or player.CharacterAdded:Wait())
player.CharacterAdded:Connect(onChar)

------------------------------------------------
-- ðŸ”„ STATE
------------------------------------------------
local autoFarm = false
getgenv().boss = false
local autoPressE = false

------------------------------------------------
-- ðŸ—ºï¸ CFRAMES
------------------------------------------------
local STARTER_CFRAME = CFrame.new(
	-74.1302795, 15.2930002, -387.613037,
	0,0,-1, 0,1,0, 1,0,0
)

local AIZEN_WAIT_CFRAME = CFrame.new(
	-468.047729, 4.84019613, -878.874878,
	-0.817907691,0,-0.575349569,
	0,1,0,
	0.575349569,0,-0.817907691
)

------------------------------------------------
-- âš¡ PROXIMITY PROMPT HOLD = 0
------------------------------------------------
task.spawn(function()
	while true do
		for _,v in pairs(workspace:GetDescendants()) do
			if v:IsA("ProximityPrompt") then
				v.HoldDuration = 0
			end
		end
		task.wait(5)
	end
end)

------------------------------------------------
-- ðŸ”˜ PRESS E
------------------------------------------------
local function pressE()
	if not autoPressE then return end
	Vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
	task.wait(0.1)
	Vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

------------------------------------------------
-- ðŸ—¡ï¸ AUTO EQUIP ANY SWORD
------------------------------------------------
local function equipSword()
	if not character then return end
	local hum = character:FindFirstChildOfClass("Humanoid")
	if not hum then return end

	for _,v in pairs(character:GetChildren()) do
		if v:IsA("Tool") then return end
	end

	for _,tool in pairs(backpack:GetChildren()) do
		if tool:IsA("Tool") and (
			tool.ToolTip == "Sword"
			or tool.Name:lower():find("sword")
		) then
			tool.Parent = character
			return
		end
	end
end

task.spawn(function()
	while true do
		if autoFarm then equipSword() end
		task.wait(0.3)
	end
end)

------------------------------------------------
-- ðŸ”Ž FIND BOSS
------------------------------------------------
local function findBoss(folder, name)
	for _,v in pairs(folder:GetChildren()) do
		if v.Name == name then
			local hum = v:FindFirstChildOfClass("Humanoid")
			local bhrp = v:FindFirstChild("HumanoidRootPart")
			if hum and bhrp and hum.Health > 0 then
				return bhrp
			end
		end
	end
	return nil
end

------------------------------------------------
-- âš”ï¸ AUTO SKILL (à¹€à¸‰à¸žà¸²à¸°à¹ƒà¸à¸¥à¹‰à¸šà¸­à¸ª)
------------------------------------------------
local skills = {Enum.KeyCode.Z,Enum.KeyCode.X,Enum.KeyCode.C,Enum.KeyCode.V}

task.spawn(function()
	while true do
		if autoFarm and hrp then
			for _,area in pairs(workspace.Main.Characters:GetChildren()) do
				local bossFolder = area:FindFirstChild("Boss")
				if bossFolder then
					for _,b in pairs(bossFolder:GetChildren()) do
						local bhrp = b:FindFirstChild("HumanoidRootPart")
						local hum = b:FindFirstChildOfClass("Humanoid")
						if bhrp and hum and hum.Health > 0 then
							if (bhrp.Position - hrp.Position).Magnitude < 25 then
								for _,k in ipairs(skills) do
									Vim:SendKeyEvent(true,k,false,game)
									task.wait(0.1)
									Vim:SendKeyEvent(false,k,false,game)
								end
							end
						end
					end
				end
			end
		end
		task.wait(0.4)
	end
end)

------------------------------------------------
-- âš”ï¸ AUTO AIZEN (PITY 0â€“24)
------------------------------------------------
task.spawn(function()
	while true do
		if autoFarm and pityBoss.Value < 25 and hrp then
			local folder = workspace.Main.Characters.Huecomundo.Boss
			local bhrp = findBoss(folder,"Aizen")

			if bhrp then
				hrp.CFrame = bhrp.CFrame * CFrame.new(0,0,5)
				pressE()
			else
				hrp.CFrame = AIZEN_WAIT_CFRAME
				pressE()
			end
		end
		task.wait()
	end
end)

------------------------------------------------
-- ðŸ”„ AIZEN WAIT LOOP (à¸—à¸¸à¸ 2 à¸§à¸´)
------------------------------------------------
task.spawn(function()
	while true do
		if autoFarm and pityBoss.Value < 25 and hrp then
			hrp.CFrame = AIZEN_WAIT_CFRAME
			pressE()
		end
		task.wait(2)
	end
end)

------------------------------------------------
-- ðŸ‘‘ ANOS / STARTER (PITY = 25)
------------------------------------------------
task.spawn(function()
	while true do
		if autoFarm and pityBoss.Value == 25 and hrp then
			local area = workspace.Main.Characters["Abyss Hill [Upper]"]
			local bhrp = findBoss(area.Boss,"Anos")
			if bhrp then
				hrp.CFrame = bhrp.CFrame * CFrame.new(0,0,6)
			else
				hrp.CFrame = STARTER_CFRAME
			end
		end
		task.wait(1)
	end
end)

------------------------------------------------
-- ðŸ–¥ï¸ iOS 26 STYLE UI + PITY REALTIME
------------------------------------------------
pcall(function()
	if playerGui:FindFirstChild("AutoFarmGUI") then
		playerGui.AutoFarmGUI:Destroy()
	end
end)

local ScreenGui = Instance.new("ScreenGui", playerGui)
ScreenGui.Name = "AutoFarmGUI"
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0,260,0,155)
Main.Position = UDim2.new(0,20,0.5,-78)
Main.BackgroundColor3 = Color3.fromRGB(18,18,22)
Main.Active = true
Main.Draggable = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,22)

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1,0,0,36)
Title.BackgroundTransparency = 1
Title.Text = "AUTO FARM"
Title.Font = Enum.Font.GothamMedium
Title.TextSize = 16
Title.TextColor3 = Color3.fromRGB(240,240,240)

local PityLabel = Instance.new("TextLabel", Main)
PityLabel.Position = UDim2.new(0,0,0,42)
PityLabel.Size = UDim2.new(1,0,0,28)
PityLabel.BackgroundTransparency = 1
PityLabel.Font = Enum.Font.Gotham
PityLabel.TextSize = 14

local Toggle = Instance.new("TextButton", Main)
Toggle.Position = UDim2.new(0,20,1,-50)
Toggle.Size = UDim2.new(1,-40,0,34)
Toggle.Font = Enum.Font.GothamBold
Toggle.TextSize = 14
Toggle.TextColor3 = Color3.new(1,1,1)
Toggle.BackgroundColor3 = Color3.fromRGB(120,60,60)
Toggle.Text = "AUTO FARM : OFF"
Instance.new("UICorner", Toggle).CornerRadius = UDim.new(0,12)

Toggle.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	getgenv().boss = autoFarm
	autoPressE = autoFarm

	Toggle.Text = "AUTO FARM : "..(autoFarm and "ON" or "OFF")
	Toggle.BackgroundColor3 = autoFarm
		and Color3.fromRGB(60,120,60)
		or Color3.fromRGB(120,60,60)
end)

------------------------------------------------
-- ðŸ”„ UPDATE PITY REALTIME
------------------------------------------------
task.spawn(function()
	while true do
		local v = pityBoss.Value
		PityLabel.Text = "Pity : "..v

		PityLabel.TextColor3 =
			(v == 25)
			and Color3.fromRGB(255,90,90)
			or Color3.fromRGB(120,255,120)

		task.wait(0.3)
	end
end)
